<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>AquaSky VR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
  <a-scene vr-mode-ui="enabled: true">
    <!-- Assets -->
    <a-assets>
      <img id="ocean360" src="assets/ocean360.jpg" crossorigin="anonymous" />
      <audio id="hotspot1Audio" src="assets/hotspot1.mp3"></audio>
      <audio id="hotspot2Audio" src="assets/hotspot2.mp3"></audio>
      <audio id="hotspot3Audio" src="assets/hotspot3.mp3"></audio>
    </a-assets>

    <!-- Fondo 360° -->
    <a-sky src="#ocean360" rotation="0 -90 0"></a-sky>

    <!-- Cámara con cursor para PC y VR -->
    <a-entity camera look-controls position="0 1.6 0">
      <a-entity 
        cursor="fuse: true; fuseTimeout: 1000; rayOrigin: mouse"
        raycaster="objects: .clickable"
        position="0 0 -1"
        geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
        material="shader: flat; opacity: 0.9">
      </a-entity>
    </a-entity>

    <!-- Hotspots -->
    <a-entity id="hotspot1" class="clickable" geometry="primitive: sphere; radius: 0.25"
              material="color: #ff4444; opacity: 0.8" position="0 1.4 -3"></a-entity>

    <a-entity id="hotspot2" class="clickable" geometry="primitive: sphere; radius: 0.25"
              material="color: #44ff44; opacity: 0.8" position="2 1.4 -4"></a-entity>

    <a-entity id="hotspot3" class="clickable" geometry="primitive: sphere; radius: 0.25"
              material="color: #4444ff; opacity: 0.8" position="-2 1.4 -4"></a-entity>

    <!-- Panel de información -->
    <a-entity id="infoBox" visible="false" position="0 1.5 -1.5">
      <a-plane width="1.6" height="0.7" color="#000" opacity="0.6"></a-plane>
      <a-text id="infoText" value="" color="#FFF" width="1.4" position="-0.75 0.1 0.01"></a-text>
    </a-entity>

    <!-- Luz ambiental -->
    <a-entity light="type: ambient; intensity: 0.8"></a-entity>

    <!-- Script de interacción -->
    <script>
      AFRAME.registerComponent('hotspot-listener', {
        schema: { audioId: {type: 'string'}, text: {type: 'string'} },
        init: function () {
          const infoBox = document.querySelector('#infoBox');
          const infoText = document.querySelector('#infoText');
          this.el.addEventListener('click', () => {
            const audio = document.querySelector('#' + this.data.audioId);
            const visible = infoBox.getAttribute('visible');
            infoText.setAttribute('value', this.data.text);
            infoBox.setAttribute('visible', !visible);
            if (!visible) {
              audio.currentTime = 0;
              audio.play();
            } else {
              audio.pause();
            }
          });
        }
      });

      // Asignar componentes a los hotspots
      document.addEventListener('DOMContentLoaded', () => {
        document.querySelector('#hotspot1').setAttribute('hotspot-listener', 
          'audioId: hotspot1Audio; text: Aquí se ve la temperatura del océano Atlántico.');
        document.querySelector('#hotspot2').setAttribute('hotspot-listener', 
          'audioId: hotspot2Audio; text: Observa la corriente de Humboldt en Sudamérica.');
        document.querySelector('#hotspot3').setAttribute('hotspot-listener', 
          'audioId: hotspot3Audio; text: Cambios de color indican concentración de clorofila.');
      });
    </script>
  </a-scene>
</body>
</html>
